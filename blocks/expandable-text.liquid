{% doc %}
  Expandable Text Block
  
  This block creates an interactive text component that displays a preview of content
  with a "Read more" link that expands to show the full text when clicked.
  
  Features:
  - Preview and full text content with smooth transitions
  - Customizable "Read more" and "Read less" button text
  - Responsive design with mobile-optimized sizing
  - Accessible with proper ARIA attributes and keyboard navigation
  - Customizable styling (colors, fonts, spacing, border radius)
  - Focus states for better accessibility
  - Rich text support for both preview and full content
  
  Usage:
  - Add this block to any section that supports blocks
  - Configure heading, preview text, and full text content
  - Customize button text for "Read more" and "Read less" actions
  - Style the component through the theme editor
  - Use rich text editor for formatted content
  
  Dependencies:
  - Requires block.id for unique CSS class generation
  - Custom JavaScript for expand/collapse functionality
  - CSS transitions for smooth animations
  - Custom web component for interactive behavior
  
  Author: Mirabelle Doiron
  Version: 1.0
  Last Updated: 2025-08-07
{% enddoc %}
{% assign expandable_text_block_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .expandable-text-{{ expandable_text_block_id }} {
    background-color: {{ block.settings.background_color }};
    padding: {{ block.settings.padding }}px;
    border-radius: {{ block.settings.border_radius }}px;
    max-width: 100%;
  }

  .expandable-text__heading-{{ expandable_text_block_id }} {
    color: {{ block.settings.heading_color }};
    font-size: {{ block.settings.heading_size }}px;
    margin: 0 0 16px 0;
    font-weight:600;
  }

  .expandable-text__content-{{ expandable_text_block_id }} {
    color: {{ block.settings.text_color }};
    font-size: {{ block.settings.text_size }}px;
    line-height: 1.6;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .expandable-text__preview-{{ expandable_text_block_id }} {
    display: block;
  }

  .expandable-text__full-{{ expandable_text_block_id }} {
    display: none;
  }

  .expandable-text__toggle-{{ expandable_text_block_id }} {
    background: none;
    border: none;
    color: {{ block.settings.link_color }};
    font-size: {{ block.settings.text_size }}px;
    text-decoration: underline;
    cursor: pointer;
    padding: 8px 0;
    margin: 0;
    display: inline-block;
    align-self: flex-start;
    transition: color 0.2s ease;
  }

  .expandable-text__toggle-{{ expandable_text_block_id }}:hover {
    color: {{ block.settings.link_hover_color }};
  }

  .expandable-text__toggle-{{ expandable_text_block_id }}:focus {
    outline: 2px solid {{ block.settings.link_color }};
    outline-offset: 2px;
  }

  .expandable-text-{{ expandable_text_block_id }}.expanded .expandable-text__preview-{{ expandable_text_block_id }} {
    display: none;
  }

  .expandable-text-{{ expandable_text_block_id }}.expanded .expandable-text__full-{{ expandable_text_block_id }} {
    display: block;
  }

  @media screen and (max-width: 749px) {
    .expandable-text__heading-{{ expandable_text_block_id }} {
      font-size: {{ block.settings.heading_size | times: 0.8 }}px;
    }

    .expandable-text-{{ expandable_text_block_id }} {
      padding: {{ block.settings.padding | times: 0.7 }}px;
    }

    .expandable-text__content-{{ expandable_text_block_id }} {
      gap: 8px;
    }

    .expandable-text__toggle-{{ expandable_text_block_id }} {
      padding: 6px 0;
      font-size: {{ block.settings.text_size | times: 0.9 }}px;
    }
  }
{% endstyle %}

<expandable-text-{{ expandable_text_block_id }}
  class="expandable-text-{{ expandable_text_block_id }}"
  {{ block.shopify_attributes }}
>
  {% if block.settings.heading != blank %}
    <h2 class="expandable-text__heading-{{ expandable_text_block_id }}">{{ block.settings.heading }}</h2>
  {% endif %}<div class="expandable-text__content-{{ expandable_text_block_id }}"><div class="expandable-text__preview-{{ expandable_text_block_id }}">
      {{ block.settings.preview_text }}
    </div>

    <div class="expandable-text__full-{{ expandable_text_block_id }}">
      {{ block.settings.full_text }}
    </div>
  </div><button
    class="expandable-text__toggle-{{ expandable_text_block_id }}"
    aria-expanded="false">
    <span class="expandable-text__read-more-{{ expandable_text_block_id }}">{{ block.settings.read_more_text }}</span>
    <span class="expandable-text__read-less-{{ expandable_text_block_id }}" style="display: none;">{{ block.settings.read_less_text }}</span>
  </button>
</expandable-text-{{ expandable_text_block_id }}>

<script>
  (function() {
    class ExpandableText{{ expandable_text_block_id }} extends HTMLElement {
      constructor() {
        super();
      }

      connectedCallback() {
        this.toggleButton = this.querySelector('.expandable-text__toggle-{{ expandable_text_block_id }}');
        this.readMoreText = this.querySelector('.expandable-text__read-more-{{ expandable_text_block_id }}');
        this.readLessText = this.querySelector('.expandable-text__read-less-{{ expandable_text_block_id }}');
        this.isExpanded = false;

        this.toggleButton.addEventListener('click', () => {
          this.toggleContent();
        });
      }

      toggleContent() {
        this.isExpanded = !this.isExpanded;
        
        if (this.isExpanded) {
          this.classList.add('expanded');
          this.toggleButton.setAttribute('aria-expanded', 'true');
          this.readMoreText.style.display = 'none';
          this.readLessText.style.display = 'inline';
        } else {
          this.classList.remove('expanded');
          this.toggleButton.setAttribute('aria-expanded', 'false');
          this.readMoreText.style.display = 'inline';
          this.readLessText.style.display = 'none';
        }
      }
    }

    customElements.define('expandable-text-{{ expandable_text_block_id }}', ExpandableText{{ expandable_text_block_id }});
  })();
</script>

{% schema %}
{
  "name": "Expandable Text",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "About Our Story"
    },
    {
      "type": "richtext",
      "id": "preview_text",
      "label": "Preview text",
      "default": "<p>This is the preview text that will be shown initially. It should be a brief introduction or summary that entices readers to want to learn more about the topic.</p>"
    },
    {
      "type": "richtext",
      "id": "full_text",
      "label": "Full text",
      "default": "<p>This is the complete text that will be revealed when the user clicks 'Read more'. You can include multiple paragraphs, formatting, and all the detailed information you want to share.</p><p>This expanded content can be much longer and contain all the details that weren't included in the preview. It's perfect for detailed product descriptions, company stories, or any content where you want to give users the choice to read more.</p>"
    },
    {
      "type": "text",
      "id": "read_more_text",
      "label": "Read more text",
      "default": "Read more"
    },
    {
      "type": "text",
      "id": "read_less_text",
      "label": "Read less text",
      "default": "Read less"
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#666666"
    },
    {
      "type": "color",
      "id": "link_color",
      "label": "Link color",
      "default": "#000f9f"
    },
    {
      "type": "color",
      "id": "link_hover_color",
      "label": "Link hover color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 16,
      "max": 48,
      "step": 2,
      "unit": "px",
      "label": "Heading size",
      "default": 24
    },
    {
      "type": "range",
      "id": "text_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Text size",
      "default": 16
    },
    {
      "type": "range",
      "id": "padding",
      "min": 0,
      "max": 60,
      "step": 4,
      "unit": "px",
      "label": "Padding",
      "default": 24
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 24,
      "step": 2,
      "unit": "px",
      "label": "Border radius",
      "default": 8
    }
  ],
  "presets": [
    {
      "name": "Expandable Text"
    }
  ]
}
{% endschema %}