{% doc %}
  @prompt
    Create a custom sign up form. 
    Including email address and mobile number. 
    Button colors can be changed, chosen from the theme setting / brand colors. 
    
    Validation for email 
    sign up
    can be vertical or horizontal,  both need to have a separate sign up button
    eg - email address sigh up
    mobile number sign up
    
    and the mobile number MUST allowed for all countries

{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-signup-form-{{ ai_gen_id }} {
    padding: {{ block.settings.form_padding }}px;
    background-color: {{ block.settings.background_color }};
    border-radius: {{ block.settings.border_radius }}px;
    max-width: 100%;
  }

  .ai-signup-form__content-{{ ai_gen_id }} {
    display: flex;
    {% if block.settings.layout == 'vertical' %}
      flex-direction: column;
      gap: 24px;
    {% else %}
      flex-direction: row;
      gap: 20px;
      align-items: flex-start;
    {% endif %}
  }

  .ai-signup-form__heading-{{ ai_gen_id }} {
    color: {{ block.settings.text_color }};
    margin: 0 0 16px 0;
    font-size: {{ block.settings.heading_size }}px;
    text-align: {{ block.settings.text_alignment }};
  }

  .ai-signup-form__subtext-{{ ai_gen_id }} {
    color: {{ block.settings.text_color }};
    font-size: {{ block.settings.text_size }}px;
    margin-bottom: 20px;
    text-align: {{ block.settings.text_alignment }};
  }

  .ai-signup-form__section-{{ ai_gen_id }} {
    {% if block.settings.layout == 'vertical' %}
      width: 100%;
    {% else %}
      flex: 1;
    {% endif %}
    padding: 20px;
    border: 1px solid {{ block.settings.section_border_color }};
    border-radius: {{ block.settings.section_border_radius }}px;
    background-color: {{ block.settings.section_background_color }};
  }

  .ai-signup-form__section-title-{{ ai_gen_id }} {
    color: {{ block.settings.text_color }};
    font-size: 18px;
    font-weight: 600;
    margin: 0 0 16px 0;
    text-align: center;
  }

  .ai-signup-form__field-group-{{ ai_gen_id }} {
    margin-bottom: 16px;
  }

  .ai-signup-form__label-{{ ai_gen_id }} {
    display: block;
    color: {{ block.settings.text_color }};
    font-size: 14px;
    margin-bottom: 6px;
    font-weight: 500;
  }

  .ai-signup-form__input-{{ ai_gen_id }} {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid {{ block.settings.input_border_color }};
    border-radius: {{ block.settings.input_border_radius }}px;
    font-size: 16px;
    background-color: {{ block.settings.input_background_color }};
    color: {{ block.settings.input_text_color }};
    transition: border-color 0.3s ease;
  }

  .ai-signup-form__input-{{ ai_gen_id }}:focus {
    outline: none;
    border-color: {{ block.settings.input_focus_color }};
  }

  .ai-signup-form__input-{{ ai_gen_id }}.error {
    border-color: {{ block.settings.error_color }};
  }

  .ai-signup-form__phone-wrapper-{{ ai_gen_id }} {
    display: flex;
    gap: 8px;
  }

  .ai-signup-form__country-select-{{ ai_gen_id }} {
    width: 120px;
    padding: 12px 8px;
    border: 2px solid {{ block.settings.input_border_color }};
    border-radius: {{ block.settings.input_border_radius }}px;
    font-size: 16px;
    background-color: {{ block.settings.input_background_color }};
    color: {{ block.settings.input_text_color }};
  }

  .ai-signup-form__phone-input-{{ ai_gen_id }} {
    flex: 1;
  }

  .ai-signup-form__button-{{ ai_gen_id }} {
    width: 100%;
    padding: 14px 28px;
    background-color: rgb({{ block.settings.button_color_scheme.settings.primary_button_background.red }}, {{ block.settings.button_color_scheme.settings.primary_button_background.green }}, {{ block.settings.button_color_scheme.settings.primary_button_background.blue }});
    color: rgb({{ block.settings.button_color_scheme.settings.primary_button_text.red }}, {{ block.settings.button_color_scheme.settings.primary_button_text.green }}, {{ block.settings.button_color_scheme.settings.primary_button_text.blue }});
    border: 2px solid rgb({{ block.settings.button_color_scheme.settings.primary_button_border.red }}, {{ block.settings.button_color_scheme.settings.primary_button_border.green }}, {{ block.settings.button_color_scheme.settings.primary_button_border.blue }});
    border-radius: {{ block.settings.button_border_radius }}px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .ai-signup-form__button-{{ ai_gen_id }}:hover {
    background-color: rgb({{ block.settings.button_color_scheme.settings.primary_button_hover_background.red }}, {{ block.settings.button_color_scheme.settings.primary_button_hover_background.green }}, {{ block.settings.button_color_scheme.settings.primary_button_hover_background.blue }});
    color: rgb({{ block.settings.button_color_scheme.settings.primary_button_hover_text.red }}, {{ block.settings.button_color_scheme.settings.primary_button_hover_text.green }}, {{ block.settings.button_color_scheme.settings.primary_button_hover_text.blue }});border-color: rgb({{ block.settings.button_color_scheme.settings.primary_button_hover_border.red }}, {{ block.settings.button_color_scheme.settings.primary_button_hover_border.green }}, {{ block.settings.button_color_scheme.settings.primary_button_hover_border.blue }});
  }

  .ai-signup-form__error-message-{{ ai_gen_id }} {
    color: {{ block.settings.error_color }};
    font-size: 14px;
    margin-top: 6px;
    display: none;
  }

  .ai-signup-form__error-message-{{ ai_gen_id }}.show {
    display: block;
  }

  .ai-signup-form__success-message-{{ ai_gen_id }} {
    color: {{ block.settings.success_color }};
    font-size: 16px;
    text-align: center;
    padding: 20px;
    background-color: rgba({{ block.settings.success_color | color_extract: 'red' }}, {{ block.settings.success_color | color_extract: 'green' }}, {{ block.settings.success_color | color_extract: 'blue' }}, 0.1);
    border-radius: {{ block.settings.border_radius }}px;
    margin-top: 16px;
    display: none;
  }

  .ai-signup-form__success-message-{{ ai_gen_id }}.show {
    display: block;
  }

  @media screen and (max-width: 749px) {
    .ai-signup-form__content-{{ ai_gen_id }} {
      flex-direction: column;
      gap: 20px;
    }

    .ai-signup-form__section-{{ ai_gen_id }} {
      flex: none;
    }

    .ai-signup-form__phone-wrapper-{{ ai_gen_id }} {
      flex-direction: column;
      gap: 12px;
    }

    .ai-signup-form__country-select-{{ ai_gen_id }} {
      width: 100%;
    }
  }
{% endstyle %}

<custom-signup-form-{{ ai_gen_id }}
  class="ai-signup-form-{{ ai_gen_id }}"
  {{ block.shopify_attributes }}
>
  {%- if block.settings.heading != blank -%}
    <h2 class="ai-signup-form__heading-{{ ai_gen_id }}">{{ block.settings.heading }}</h2>
  {%- endif -%}

  {%- if block.settings.subtext != blank -%}
    <div class="ai-signup-form__subtext-{{ ai_gen_id }}">{{ block.settings.subtext }}</div>
  {%- endif -%}

  <div class="ai-signup-form__content-{{ ai_gen_id }}"><div class="ai-signup-form__section-{{ ai_gen_id }}">
      <h3 class="ai-signup-form__section-title-{{ ai_gen_id }}">Email Signup</h3>
      {%- form 'contact', id: 'email-form-' | append: ai_gen_id -%}
        <input type="hidden" name="contact[tags]" value="email-newsletter">
        
        <div class="ai-signup-form__field-group-{{ ai_gen_id }}">
          <label for="email-{{ ai_gen_id }}" class="ai-signup-form__label-{{ ai_gen_id }}">
            Email Address *
          </label>
          <input
            type="email"
            id="email-{{ ai_gen_id }}"
            name="contact[email]"
            class="ai-signup-form__input-{{ ai_gen_id }}"
            value="{{ form.email }}"
            aria-required="true"
            autocorrect="off"
            autocapitalize="off"
            autocomplete="email"
            placeholder="{{ block.settings.email_placeholder }}"
            required
          >
          <div class="ai-signup-form__error-message-{{ ai_gen_id }}" id="email-error-{{ ai_gen_id }}">
            Please enter a valid email address
          </div>
        </div>

        <button
          type="submit"
          class="ai-signup-form__button-{{ ai_gen_id }}"
        >
          {{ block.settings.email_button_label }}
        </button>

        {%- if form.errors -%}
          <div class="ai-signup-form__error-message-{{ ai_gen_id }} show">
            {%- for field in form.errors -%}
              {{ form.errors.messages[field] }}
            {%- endfor -%}
          </div>
        {%- endif -%}

        {%- if form.posted_successfully? -%}
          <div class="ai-signup-form__success-message-{{ ai_gen_id }} show">
            {{ block.settings.email_success_message }}
          </div>
        {%- endif -%}
      {%- endform -%}
    </div>

    <div class="ai-signup-form__section-{{ ai_gen_id }}">
      <h3 class="ai-signup-form__section-title-{{ ai_gen_id }}">SMS Signup</h3>
      
      {%- form 'contact', id: 'sms-form-' | append: ai_gen_id -%}
        <input type="hidden" name="contact[tags]" value="sms-newsletter">
        
        <div class="ai-signup-form__field-group-{{ ai_gen_id }}">
          <label for="phone-{{ ai_gen_id }}" class="ai-signup-form__label-{{ ai_gen_id }}">
            Mobile Number *
          </label>
          <div class="ai-signup-form__phone-wrapper-{{ ai_gen_id }}">
            <select 
              class="ai-signup-form__country-select-{{ ai_gen_id }}" 
              id="country-code-{{ ai_gen_id }}"
              name="contact[country_code]"
            >
              <option value="+1">ðŸ‡ºðŸ‡¸ +1</option>
              <option value="+1">ðŸ‡¨ðŸ‡¦ +1</option>
              <option value="+44">ðŸ‡¬ðŸ‡§ +44</option>
              <option value="+33">ðŸ‡«ðŸ‡· +33</option>
              <option value="+49">ðŸ‡©ðŸ‡ª +49</option>
              <option value="+39">ðŸ‡®ðŸ‡¹ +39</option>
              <option value="+34">ðŸ‡ªðŸ‡¸ +34</option>
              <option value="+31">ðŸ‡³ðŸ‡± +31</option>
              <option value="+32">ðŸ‡§ðŸ‡ª +32</option>
              <option value="+41">ðŸ‡¨ðŸ‡­ +41</option>
              <option value="+43">ðŸ‡¦ðŸ‡¹ +43</option>
              <option value="+45">ðŸ‡©ðŸ‡° +45</option>
              <option value="+46">ðŸ‡¸ðŸ‡ª +46</option>
              <option value="+47">ðŸ‡³ðŸ‡´ +47</option>
              <option value="+358">ðŸ‡«ðŸ‡® +358</option>
              <option value="+61">ðŸ‡¦ðŸ‡º +61</option>
              <option value="+64">ðŸ‡³ðŸ‡¿ +64</option>
              <option value="+81">ðŸ‡¯ðŸ‡µ +81</option>
              <option value="+82">ðŸ‡°ðŸ‡· +82</option>
              <option value="+86">ðŸ‡¨ðŸ‡³ +86</option>
              <option value="+91">ðŸ‡®ðŸ‡³ +91</option>
              <option value="+65">ðŸ‡¸ðŸ‡¬ +65</option>
              <option value="+60">ðŸ‡²ðŸ‡¾ +60</option>
              <option value="+66">ðŸ‡¹ðŸ‡­ +66</option>
              <option value="+84">ðŸ‡»ðŸ‡³ +84</option>
              <option value="+63">ðŸ‡µðŸ‡­ +63</option>
              <option value="+62">ðŸ‡®ðŸ‡© +62</option>
              <option value="+852">ðŸ‡­ðŸ‡° +852</option>
              <option value="+886">ðŸ‡¹ðŸ‡¼ +886</option>
              <option value="+55">ðŸ‡§ðŸ‡· +55</option>
              <option value="+52">ðŸ‡²ðŸ‡½ +52</option>
              <option value="+54">ðŸ‡¦ðŸ‡· +54</option>
              <option value="+56">ðŸ‡¨ðŸ‡± +56</option>
              <option value="+57">ðŸ‡¨ðŸ‡´ +57</option>
              <option value="+51">ðŸ‡µðŸ‡ª +51</option>
              <option value="+58">ðŸ‡»ðŸ‡ª +58</option>
              <option value="+27">ðŸ‡¿ðŸ‡¦ +27</option>
              <option value="+234">ðŸ‡³ðŸ‡¬ +234</option>
              <option value="+254">ðŸ‡°ðŸ‡ª +254</option>
              <option value="+20">ðŸ‡ªðŸ‡¬ +20</option>
              <option value="+212">ðŸ‡²ðŸ‡¦ +212</option>
              <option value="+213">ðŸ‡©ðŸ‡¿ +213</option>
              <option value="+216">ðŸ‡¹ðŸ‡³ +216</option>
              <option value="+218">ðŸ‡±ðŸ‡¾ +218</option>
              <option value="+90">ðŸ‡¹ðŸ‡· +90</option>
              <option value="+98">ðŸ‡®ðŸ‡· +98</option>
              <option value="+966">ðŸ‡¸ðŸ‡¦ +966</option>
              <option value="+971">ðŸ‡¦ðŸ‡ª +971</option>
              <option value="+974">ðŸ‡¶ðŸ‡¦ +974</option>
              <option value="+965">ðŸ‡°ðŸ‡¼ +965</option>
              <option value="+973">ðŸ‡§ðŸ‡­ +973</option>
              <option value="+968">ðŸ‡´ðŸ‡² +968</option>
              <option value="+962">ðŸ‡¯ðŸ‡´ +962</option>
              <option value="+961">ðŸ‡±ðŸ‡§ +961</option>
              <option value="+972">ðŸ‡®ðŸ‡± +972</option>
              <option value="+7">ðŸ‡·ðŸ‡º +7</option>
              <option value="+380">ðŸ‡ºðŸ‡¦ +380</option>
              <option value="+48">ðŸ‡µðŸ‡± +48</option>
              <option value="+420">ðŸ‡¨ðŸ‡¿ +420</option>
              <option value="+421">ðŸ‡¸ðŸ‡° +421</option>
              <option value="+36">ðŸ‡­ðŸ‡º +36</option>
              <option value="+40">ðŸ‡·ðŸ‡´ +40</option>
              <option value="+359">ðŸ‡§ðŸ‡¬ +359</option>
              <option value="+385">ðŸ‡­ðŸ‡· +385</option>
              <option value="+386">ðŸ‡¸ðŸ‡® +386</option>
              <option value="+372">ðŸ‡ªðŸ‡ª +372</option>
              <option value="+371">ðŸ‡±ðŸ‡» +371</option>
              <option value="+370">ðŸ‡±ðŸ‡¹ +370</option>
            </select>
            <input
              type="tel"
              id="phone-{{ ai_gen_id }}"
              name="contact[phone]"
              class="ai-signup-form__input-{{ ai_gen_id }} ai-signup-form__phone-input-{{ ai_gen_id }}"
              autocomplete="tel"
              placeholder="{{ block.settings.phone_placeholder }}"
              required
            >
          </div>
          <div class="ai-signup-form__error-message-{{ ai_gen_id }}" id="phone-error-{{ ai_gen_id }}">
            Please enter a valid mobile number
          </div>
        </div>

        <button
          type="submit"
          class="ai-signup-form__button-{{ ai_gen_id }}"
        >
          {{ block.settings.sms_button_label }}
        </button>

        {%- if form.errors -%}
          <div class="ai-signup-form__error-message-{{ ai_gen_id }} show">
            {%- for field in form.errors -%}
              {{ form.errors.messages[field] }}
            {%- endfor -%}
          </div>
        {%- endif -%}

        {%- if form.posted_successfully? -%}
          <div class="ai-signup-form__success-message-{{ ai_gen_id }} show">
            {{ block.settings.sms_success_message }}
          </div>
        {%- endif -%}
      {%- endform -%}
    </div>
  </div>
</custom-signup-form-{{ ai_gen_id }}>

<script>
(function() {
  class CustomSignupForm{{ ai_gen_id }} extends HTMLElement {
    constructor() {
      super();
    }

    connectedCallback() {
      this.emailForm = this.querySelector('#email-form-{{ ai_gen_id }}');
      this.smsForm = this.querySelector('#sms-form-{{ ai_gen_id }}');
      this.emailInput = this.querySelector('#email-{{ ai_gen_id }}');
      this.phoneInput = this.querySelector('#phone-{{ ai_gen_id }}');
      this.countrySelect = this.querySelector('#country-code-{{ ai_gen_id }}');
      this.emailError = this.querySelector('#email-error-{{ ai_gen_id }}');
      this.phoneError = this.querySelector('#phone-error-{{ ai_gen_id }}');

      this.setupEventListeners();
    }

    setupEventListeners() {
      this.emailInput.addEventListener('blur', () => this.validateEmail());
      this.emailInput.addEventListener('input', () => this.clearEmailError());
      
      this.phoneInput.addEventListener('blur', () => this.validatePhone());
      this.phoneInput.addEventListener('input', () => this.clearPhoneError());

      this.emailForm.addEventListener('submit', (e) => this.handleEmailSubmit(e));
      this.smsForm.addEventListener('submit', (e) => this.handleSmsSubmit(e));
    }

    validateEmail() {
      const email = this.emailInput.value.trim();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      
      if (email && !emailRegex.test(email)) {
        this.showEmailError();
        return false;
      }
      
      this.clearEmailError();
      return true;
    }

    validatePhone() {
      const phone = this.phoneInput.value.trim();
      
      if (phone) {
        const phoneRegex = /^[\d\s\-\(\)]+$/;
        const cleanPhone = phone.replace(/[\s\-\(\)]/g, '');
        
        if (!phoneRegex.test(phone) || cleanPhone.length < 7 || cleanPhone.length > 15) {
          this.showPhoneError();
          return false;
        }
      }
      
      this.clearPhoneError();
      return true;
    }

    showEmailError() {
      this.emailInput.classList.add('error');
      this.emailError.classList.add('show');
    }

    clearEmailError() {
      this.emailInput.classList.remove('error');
      this.emailError.classList.remove('show');
    }

    showPhoneError() {
      this.phoneInput.classList.add('error');
      this.phoneError.classList.add('show');
    }

    clearPhoneError() {
      this.phoneInput.classList.remove('error');
      this.phoneError.classList.remove('show');
    }

    handleEmailSubmit(e) {
      const isEmailValid = this.validateEmail();
      
      if (!isEmailValid) {
        e.preventDefault();
        return false;
      }
      
      return true;
    }

    handleSmsSubmit(e) {
      const isPhoneValid = this.validatePhone();
      
      if (!isPhoneValid) {
        e.preventDefault();
        return false;
      }

      const countryCode = this.countrySelect.value;
      const phoneNumber = this.phoneInput.value.trim();
      const fullPhoneNumber = countryCode + phoneNumber;
      
      const hiddenPhoneInput = document.createElement('input');
      hiddenPhoneInput.type = 'hidden';
      hiddenPhoneInput.name = 'contact[phone]';
      hiddenPhoneInput.value = fullPhoneNumber;
      
      this.smsForm.appendChild(hiddenPhoneInput);
      
      return true;
    }
  }

  customElements.define('custom-signup-form-{{ ai_gen_id }}', CustomSignupForm{{ ai_gen_id }});
})();
</script>

{% schema %}
{
  "name": "Dual signup form",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "richtext",
      "id": "heading",
      "label": "Heading",
      "default": "<p>Stay connected with us</p>"
    },
    {
      "type": "richtext",
      "id": "subtext",
      "label": "Subtext",
      "default": "<p>Choose how you'd like to receive updates from us.</p>"
    },
    {
      "type": "text",
      "id": "email_placeholder",
      "label": "Email placeholder",
      "default": "Enter your email address"
    },
    {
      "type": "text",
      "id": "phone_placeholder",
      "label": "Phone placeholder",
      "default": "Enter your mobile number"
    },
    {
      "type": "text",
      "id": "email_button_label",
      "label": "Email button label",
      "default": "Subscribe to Email"
    },
    {
      "type": "text",
      "id": "sms_button_label",
      "label": "SMS button label",
      "default": "Subscribe to SMS"
    },
    {
      "type": "richtext",
      "id": "email_success_message",
      "label": "Email success message",
      "default": "<p>Thank you for subscribing to our email newsletter!</p>"
    },
    {
      "type": "richtext",
      "id": "sms_success_message",
      "label": "SMS success message",
      "default": "<p>Thank you for subscribing to our SMS updates!</p>"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "layout",
      "label": "Form layout",
      "options": [
        {
          "value": "horizontal",
          "label": "Horizontal"
        },
        {
          "value": "vertical",
          "label": "Vertical"
        }
      ],
      "default": "horizontal"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#f8f8f8"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#000000"
    },
    {
      "type": "color_scheme",
      "id": "button_color_scheme",
      "label": "Button color scheme",
      "default": "scheme-1"
    },
    {
      "type": "color",
      "id": "section_background_color",
      "label": "Section background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "section_border_color",
      "label": "Section border color",
      "default": "#e0e0e0"
    },
    {
      "type": "color",
      "id": "input_background_color",
      "label": "Input background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "input_text_color",
      "label": "Input text color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "input_border_color",
      "label": "Input border color",
      "default": "#e0e0e0"
    },
    {
      "type": "color",
      "id": "input_focus_color",
      "label": "Input focus color",
      "default": "#007acc"
    },
    {
      "type": "color",
      "id": "error_color",
      "label": "Error color",
      "default": "#d82c0d"
    },
    {
      "type": "color",
      "id": "success_color",
      "label": "Success color",
      "default": "#008060"
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "range",
      "id": "form_padding",
      "min": 0,
      "max": 60,
      "step": 4,
      "unit": "px",
      "label": "Form padding",
      "default": 32
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Form border radius",
      "default": 8
    },
    {
      "type": "range",
      "id": "section_border_radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Section border radius",
      "default": 6
    },
    {
      "type": "range",
      "id": "input_border_radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Input border radius",
      "default": 6
    },
    {
      "type": "range",
      "id": "button_border_radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Button border radius",
      "default": 6
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 16,
      "max": 48,
      "step": 2,
      "unit": "px",
      "label": "Heading size",
      "default": 28
    },
    {
      "type": "range",
      "id": "text_size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Text size",
      "default": 16
    }
  ],
  "presets": [
    {
      "name": "Dual signup form"
    }
  ]
}
{% endschema %}