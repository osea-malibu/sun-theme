{% doc %}
  @prompt
    Create a custom sign up form. 
    Including email address and mobile number. 
    Button colors can be changed, chosen from the theme setting / brand colors. 
    
    Validation for email 
    sign up
    can be vertical or horizontal

{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-signup-form-{{ ai_gen_id }} {
    padding: {{ block.settings.form_padding }}px;
    background-color: {{ block.settings.background_color }};
    border-radius: {{ block.settings.border_radius }}px;
    max-width: 100%;
  }

  .ai-signup-form__content-{{ ai_gen_id }} {
    display: flex;
    {% if block.settings.layout == 'vertical' %}
      flex-direction: column;gap: 16px;
    {% else %}
      flex-direction: row;
      gap: 12px;
      align-items: flex-start;
    {% endif %}
  }

  .ai-signup-form__heading-{{ ai_gen_id }} {
    color: {{ block.settings.text_color }};
    margin: 0 0 16px 0;
    font-size: {{ block.settings.heading_size }}px;
    text-align: {{ block.settings.text_alignment }};
  }

  .ai-signup-form__subtext-{{ ai_gen_id }} {
    color: {{ block.settings.text_color }};
    font-size: {{ block.settings.text_size }}px;
    margin-bottom: 20px;
    text-align: {{ block.settings.text_alignment }};
  }

  .ai-signup-form__fields-{{ ai_gen_id }} {
    {% if block.settings.layout == 'vertical' %}
      width: 100%;
    {% else %}
      flex-grow: 1;
      display: flex;
      gap: 12px;
    {% endif %}
  }

  .ai-signup-form__field-group-{{ ai_gen_id }} {
    {% if block.settings.layout == 'vertical' %}
      margin-bottom: 16px;
    {% else %}
      flex: 1;
    {% endif %}
  }

  .ai-signup-form__label-{{ ai_gen_id }} {
    display: block;
    color: {{ block.settings.text_color }};
    font-size: 14px;
    margin-bottom: 6px;
    font-weight: 500;
  }

  .ai-signup-form__input-{{ ai_gen_id }} {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid {{ block.settings.input_border_color }};
    border-radius: {{ block.settings.input_border_radius }}px;
    font-size: 16px;
    background-color: {{ block.settings.input_background_color }};
    color: {{ block.settings.input_text_color }};
    transition: border-color 0.3s ease;
  }

  .ai-signup-form__input-{{ ai_gen_id }}:focus {
    outline: none;
    border-color: {{ block.settings.input_focus_color }};
  }

  .ai-signup-form__input-{{ ai_gen_id }}.error {
    border-color: {{ block.settings.error_color }};
  }

  .ai-signup-form__button-{{ ai_gen_id }} {
    {% if block.settings.layout == 'vertical' %}
      width: 100%;
    {% else %}
      padding: 12px 24px;
      flex-shrink: 0;
      align-self: flex-end;
    {% endif %}
    padding: 14px 28px;
    background-color: rgb({{ block.settings.button_color_scheme.settings.primary_button_background.red }}, {{ block.settings.button_color_scheme.settings.primary_button_background.green }}, {{ block.settings.button_color_scheme.settings.primary_button_background.blue }});
    color: rgb({{ block.settings.button_color_scheme.settings.primary_button_text.red }}, {{ block.settings.button_color_scheme.settings.primary_button_text.green }}, {{ block.settings.button_color_scheme.settings.primary_button_text.blue }});
    border: 2px solid rgb({{ block.settings.button_color_scheme.settings.primary_button_border.red }}, {{ block.settings.button_color_scheme.settings.primary_button_border.green }}, {{ block.settings.button_color_scheme.settings.primary_button_border.blue }});
    border-radius: {{ block.settings.button_border_radius }}px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .ai-signup-form__button-{{ ai_gen_id }}:hover {
    background-color: rgb({{ block.settings.button_color_scheme.settings.primary_button_hover_background.red }}, {{ block.settings.button_color_scheme.settings.primary_button_hover_background.green }}, {{ block.settings.button_color_scheme.settings.primary_button_hover_background.blue }});
    color: rgb({{ block.settings.button_color_scheme.settings.primary_button_hover_text.red }}, {{ block.settings.button_color_scheme.settings.primary_button_hover_text.green }}, {{ block.settings.button_color_scheme.settings.primary_button_hover_text.blue }});
    border-color: rgb({{ block.settings.button_color_scheme.settings.primary_button_hover_border.red }}, {{ block.settings.button_color_scheme.settings.primary_button_hover_border.green }}, {{ block.settings.button_color_scheme.settings.primary_button_hover_border.blue }});
  }

  .ai-signup-form__error-message-{{ ai_gen_id }} {
    color: {{ block.settings.error_color }};
    font-size: 14px;
    margin-top: 6px;
    display: none;
  }

  .ai-signup-form__error-message-{{ ai_gen_id }}.show {
    display: block;
  }

  .ai-signup-form__success-message-{{ ai_gen_id }} {
    color: {{ block.settings.success_color }};
    font-size: 16px;
    text-align: center;
    padding: 20px;
    background-color: rgba({{ block.settings.success_color | color_extract: 'red' }}, {{ block.settings.success_color | color_extract: 'green' }}, {{ block.settings.success_color | color_extract: 'blue' }}, 0.1);
    border-radius: {{ block.settings.border_radius }}px;
    margin-top: 16px;
    display: none;
  }

  .ai-signup-form__success-message-{{ ai_gen_id }}.show {
    display: block;
  }

  @media screen and (max-width: 749px) {
    .ai-signup-form__content-{{ ai_gen_id }} {
      flex-direction: column;
      gap: 16px;
    }

    .ai-signup-form__fields-{{ ai_gen_id }} {
      width: 100%;
      flex-direction: column;
      gap: 16px;
    }

    .ai-signup-form__field-group-{{ ai_gen_id }} {
      flex: none;
      margin-bottom: 0;
    }

    .ai-signup-form__button-{{ ai_gen_id }} {
      width: 100%;
      align-self: stretch;
    }
  }
{% endstyle %}

<custom-signup-form-{{ ai_gen_id }}
  class="ai-signup-form-{{ ai_gen_id }}"
  {{ block.shopify_attributes }}
>
  {%- form 'contact' -%}
    <input type="hidden" name="contact[tags]" value="newsletter">
    
    {%- if block.settings.heading != blank -%}
      <h2 class="ai-signup-form__heading-{{ ai_gen_id }}">{{ block.settings.heading }}</h2>
    {%- endif -%}

    {%- if block.settings.subtext != blank -%}
      <div class="ai-signup-form__subtext-{{ ai_gen_id }}">{{ block.settings.subtext }}</div>
    {%- endif -%}

    <div class="ai-signup-form__content-{{ ai_gen_id }}">
      <div class="ai-signup-form__fields-{{ ai_gen_id }}">
        <div class="ai-signup-form__field-group-{{ ai_gen_id }}">
          <label for="email-{{ ai_gen_id }}" class="ai-signup-form__label-{{ ai_gen_id }}">
            Email Address *
          </label>
          <input
            type="email"
            id="email-{{ ai_gen_id }}"
            name="contact[email]"
            class="ai-signup-form__input-{{ ai_gen_id }}"
            value="{{ form.email }}"
            aria-required="true"
            autocorrect="off"
            autocapitalize="off"
            autocomplete="email"
            placeholder="{{ block.settings.email_placeholder }}"
            required
          >
          <div class="ai-signup-form__error-message-{{ ai_gen_id }}" id="email-error-{{ ai_gen_id }}">
            Please enter a valid email address
          </div>
        </div>

        <div class="ai-signup-form__field-group-{{ ai_gen_id }}">
          <label for="phone-{{ ai_gen_id }}" class="ai-signup-form__label-{{ ai_gen_id }}">
            Mobile Number
          </label>
          <input
            type="tel"
            id="phone-{{ ai_gen_id }}"
            name="contact[phone]"
            class="ai-signup-form__input-{{ ai_gen_id }}"
            autocomplete="tel"
            placeholder="{{ block.settings.phone_placeholder }}"
          >
          <div class="ai-signup-form__error-message-{{ ai_gen_id }}" id="phone-error-{{ ai_gen_id }}">
            Please enter a valid mobile number
          </div>
        </div>
      </div>

      <button
        type="submit"
        class="ai-signup-form__button-{{ ai_gen_id }}"
      >
        {{ block.settings.button_label }}
      </button>
    </div>

    {%- if form.errors -%}
      <div class="ai-signup-form__error-message-{{ ai_gen_id }} show">
        {%- for field in form.errors -%}
          {{ form.errors.messages[field] }}
        {%- endfor -%}
      </div>
    {%- endif -%}

    {%- if form.posted_successfully? -%}
      <div class="ai-signup-form__success-message-{{ ai_gen_id }} show">
        {{ block.settings.success_message }}
      </div>
    {%- endif -%}
  {%- endform -%}
</custom-signup-form-{{ ai_gen_id }}>

<script>
(function() {
  class CustomSignupForm{{ ai_gen_id }} extends HTMLElement {
    constructor() {
      super();
    }

    connectedCallback() {
      this.form = this.querySelector('form');
      this.emailInput = this.querySelector('#email-{{ ai_gen_id }}');
      this.phoneInput = this.querySelector('#phone-{{ ai_gen_id }}');
      this.emailError = this.querySelector('#email-error-{{ ai_gen_id }}');
      this.phoneError = this.querySelector('#phone-error-{{ ai_gen_id }}');

      this.setupEventListeners();
    }

    setupEventListeners() {
      this.emailInput.addEventListener('blur', () => this.validateEmail());
      this.emailInput.addEventListener('input', () => this.clearEmailError());
      
      this.phoneInput.addEventListener('blur', () => this.validatePhone());
      this.phoneInput.addEventListener('input', () => this.clearPhoneError());

      this.form.addEventListener('submit', (e) => this.handleSubmit(e));
    }

    validateEmail() {
      const email = this.emailInput.value.trim();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      
      if (email && !emailRegex.test(email)) {
        this.showEmailError();
        return false;
      }
      
      this.clearEmailError();
      return true;
    }

    validatePhone() {
      const phone = this.phoneInput.value.trim();
      
      if (phone) {
        const phoneRegex = /^[\+]?[1-9][\d]{0,15}$/;
        const cleanPhone = phone.replace(/[\s\-\(\)]/g, '');
        
        if (!phoneRegex.test(cleanPhone) || cleanPhone.length < 10) {
          this.showPhoneError();
          return false;
        }
      }
      
      this.clearPhoneError();
      return true;
    }

    showEmailError() {
      this.emailInput.classList.add('error');
      this.emailError.classList.add('show');
    }

    clearEmailError() {
      this.emailInput.classList.remove('error');
      this.emailError.classList.remove('show');
    }

    showPhoneError() {
      this.phoneInput.classList.add('error');
      this.phoneError.classList.add('show');
    }

    clearPhoneError() {
      this.phoneInput.classList.remove('error');
      this.phoneError.classList.remove('show');
    }

    handleSubmit(e) {
      const isEmailValid = this.validateEmail();
      const isPhoneValid = this.validatePhone();
      
      if (!isEmailValid || !isPhoneValid) {
        e.preventDefault();
        return false;
      }
      
      return true;
    }
  }

  customElements.define('custom-signup-form-{{ ai_gen_id }}', CustomSignupForm{{ ai_gen_id }});
})();
</script>

{% schema %}
{
  "name": "Custom signup form",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "richtext",
      "id": "heading",
      "label": "Heading",
      "default": "<p>Stay in the loop</p>"
    },
    {
      "type": "richtext",
      "id": "subtext",
      "label": "Subtext",
      "default": "<p>Subscribe to our newsletter for the latest updates and exclusive offers.</p>"
    },
    {
      "type": "text",
      "id": "email_placeholder",
      "label": "Email placeholder",
      "default": "Enter your email address"
    },
    {
      "type": "text",
      "id": "phone_placeholder",
      "label": "Phone placeholder",
      "default": "Enter your mobile number"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button label",
      "default": "Sign Up"
    },
    {
      "type": "richtext",
      "id": "success_message",
      "label": "Success message",
      "default": "<p>Thank you for subscribing! We'll be in touch soon.</p>"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "layout",
      "label": "Form layout",
      "options": [
        {
          "value": "horizontal",
          "label": "Horizontal"
        },
        {
          "value": "vertical",
          "label": "Vertical"
        }
      ],
      "default": "horizontal"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "left"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#f8f8f8"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#000000"
    },
    {
      "type": "color_scheme",
      "id": "button_color_scheme",
      "label": "Button color scheme",
      "default": "scheme-1"
    },
    {
      "type": "color",
      "id": "input_background_color",
      "label": "Input background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "input_text_color",
      "label": "Input text color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "input_border_color",
      "label": "Input border color",
      "default": "#e0e0e0"
    },
    {
      "type": "color",
      "id": "input_focus_color",
      "label": "Input focus color",
      "default": "#007acc"
    },
    {
      "type": "color",
      "id": "error_color",
      "label": "Error color",
      "default": "#d82c0d"
    },
    {
      "type": "color",
      "id": "success_color",
      "label": "Success color",
      "default": "#008060"
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "range",
      "id": "form_padding",
      "min": 0,
      "max": 60,
      "step": 4,
      "unit": "px",
      "label": "Form padding",
      "default": 32
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Form border radius",
      "default": 8
    },
    {
      "type": "range",
      "id": "input_border_radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Input border radius",
      "default": 6
    },
    {
      "type": "range",
      "id": "button_border_radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Button border radius",
      "default": 6
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 16,
      "max": 48,
      "step": 2,
      "unit": "px",
      "label": "Heading size",
      "default": 28
    },
    {
      "type": "range",
      "id": "text_size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Text size",
      "default": 16
    }
  ],
  "presets": [
    {
      "name": "Custom signup form"
    }
  ]
}
{% endschema %}